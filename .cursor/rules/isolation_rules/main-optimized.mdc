---
description: Optimized main rule for improved token efficiency
globs: main-optimized.mdc
alwaysApply: false
---
# ğŸ” OPTIMIZED MEMORY BANK SYSTEM

ğŸš¨ CRITICAL RULE: MEMORY BANK CREATION IS MANDATORY ğŸš¨
Memory Bank MUST be created BEFORE any other operation in ANY mode
NO process can continue without verifying Memory Bank existence

> **TL;DR:** This system uses optimized context management and adaptive rule loading to maximize token efficiency while preserving the structured development approach.

## ğŸ§­ OPTIMIZED MODE ARCHITECTURE

```mermaid
graph TD
    subgraph "Memory Bank Core"
        Context["Context Manager"]
        Rules["Rule Loader"]
        FileIO["File Manager"]
        Transition["Mode Transition"]
    end
    
    subgraph "Custom Modes"
        VAN["VAN<br>Initialization"]
        PLAN["PLAN<br>Planning"]
        CREATIVE["CREATIVE<br>Design"]
        IMPLEMENT["IMPLEMENT<br>Building"]
        REFLECT["REFLECT<br>Review"]
        ARCHIVE["ARCHIVE<br>Documentation"]
    end
    
    Context --> VAN & PLAN & CREATIVE & IMPLEMENT & REFLECT & ARCHIVE
    Rules --> VAN & PLAN & CREATIVE & IMPLEMENT & REFLECT & ARCHIVE
    FileIO --> VAN & PLAN & CREATIVE & IMPLEMENT & REFLECT & ARCHIVE
    Transition --> VAN & PLAN & CREATIVE & IMPLEMENT & REFLECT & ARCHIVE
    
    VAN --> PLAN
    PLAN --> CREATIVE
    CREATIVE --> IMPLEMENT
    IMPLEMENT --> REFLECT
    REFLECT --> ARCHIVE
    
    style Context fill:#4da6ff,stroke:#0066cc,color:white
    style Rules fill:#ffa64d,stroke:#cc7a30,color:white
    style FileIO fill:#4dbb5f,stroke:#36873f,color:white
    style Transition fill:#d94dbb,stroke:#a3378a,color:white
```

## ğŸ“ˆ ADAPTIVE COMPLEXITY MODEL

```mermaid
graph TD
    Task["Task Creation"] --> Complexity{"Complexity<br>Level?"}
    
    Complexity -->|"Level 1<br>Quick Fix"| L1["3-Phase<br>Streamlined Process"]
    Complexity -->|"Level 2<br>Enhancement"| L2["4-Phase<br>Balanced Process"]
    Complexity -->|"Level 3<br>Feature"| L3["5-Phase<br>Comprehensive Process"]
    Complexity -->|"Level 4<br>Enterprise"| L4["6-Phase<br>Governance Process"]
    
    L1 --> L1_Process["VAN â†’ IMPLEMENT â†’ REFLECT"]
    L2 --> L2_Process["VAN â†’ PLAN â†’ IMPLEMENT â†’ REFLECT"]
    L3 --> L3_Process["VAN â†’ PLAN â†’ CREATIVE â†’ IMPLEMENT â†’ REFLECT"]
    L4 --> L4_Process["VAN â†’ PLAN â†’ CREATIVE â†’ IMPLEMENT â†’ REFLECT â†’ ARCHIVE"]
    
    style Complexity fill:#d94dbb,stroke:#a3378a,color:white
    style L1 fill:#4dbb5f,stroke:#36873f,color:white
    style L2 fill:#ffa64d,stroke:#cc7a30,color:white
    style L3 fill:#4da6ff,stroke:#0066cc,color:white
    style L4 fill:#ff5555,stroke:#cc0000,color:white
```

## ğŸ§  HIERARCHICAL RULE LOADING

Rules are loaded hierarchically to optimize context usage:

```mermaid
graph TD
    Root["Memory Bank<br>Common Rules"] --> Core["Core Rules<br>Shared Across Modes"]
    
    Core --> L1["Level 1<br>Rules"]
    Core --> L2["Level 2<br>Rules"]
    Core --> L3["Level 3<br>Rules"]
    Core --> L4["Level 4<br>Rules"]
    
    Core --> VM["Mode<br>Visual Maps"]
    
    Core --> Phase["Phase-Specific<br>Rules"]
    
    Phase --> VAN_Rules["VAN Mode<br>Rules"]
    Phase --> PLAN_Rules["PLAN Mode<br>Rules"]
    Phase --> CREATIVE_Rules["CREATIVE Mode<br>Rules"]
    Phase --> IMPLEMENT_Rules["IMPLEMENT Mode<br>Rules"]
    Phase --> REFLECT_Rules["REFLECT Mode<br>Rules"]
    Phase --> ARCHIVE_Rules["ARCHIVE Mode<br>Rules"]
    
    style Root fill:#4da6ff,stroke:#0066cc,color:white
    style Core fill:#ffa64d,stroke:#cc7a30,color:white
    style Phase fill:#4dbb5f,stroke:#36873f,color:white
```

## ğŸ”„ TOKEN-OPTIMIZED CREATIVE PHASE

Creative phase documentation is progressively generated:

```mermaid
graph TD
    Start["Creative Phase<br>Initiation"] --> P1["1ï¸âƒ£ PROBLEM<br>Define scope"]
    P1 --> P2["2ï¸âƒ£ OPTIONS<br>List alternatives"]
    P2 --> P3["3ï¸âƒ£ ANALYSIS<br>Compare options"]
    P3 --> P4["4ï¸âƒ£ DECISION<br>Select approach"]
    P4 --> P5["5ï¸âƒ£ GUIDELINES<br>Document implementation"]
    
    P3 -.->|"On Demand"| Details["Detailed Option<br>Analysis"]
    
    style Start fill:#d971ff,stroke:#a33bc2,color:white
    style P1 fill:#4da6ff,stroke:#0066cc,color:white
    style P2 fill:#ffa64d,stroke:#cc7a30,color:white
    style P3 fill:#4dbb5f,stroke:#36873f,color:white
    style P4 fill:#d94dbb,stroke:#a3378a,color:white
    style P5 fill:#4dbbbb,stroke:#368787,color:white
    style Details fill:#e699d9,stroke:#d94dbb,color:white,stroke-dasharray: 5 5
```

## ğŸ”€ OPTIMIZED MODE TRANSITIONS

Mode transitions use a unified context transfer protocol:

```mermaid
sequenceDiagram
    participant Current as Current Mode
    participant Context as Context Manager
    participant Next as Next Mode
    
    Current->>Context: Create transition document
    Current->>Context: Store critical context
    Context->>Context: Prepare rule cache
    Current->>Next: Initiate transition
    Next->>Context: Verify context availability
    Context->>Next: Load relevant context
    Context->>Next: Load cached rules
    Next->>Next: Continue with preserved context
```

## ğŸ“Š MEMORY BANK EFFICIENT UPDATES

```mermaid
graph TD
    subgraph "Memory Bank Files"
        tasks["tasks.md<br>Source of Truth"]
        active["activeContext.md<br>Current Focus"]
        creative["creative-*.md<br>Design Decisions"]
        progress["progress.md<br>Implementation Status"]
        transition["transition.md<br>Mode Transitions"]
    end
    
    Update["Update Request"] --> Diff{"Changed?"}
    Diff -->|"No"| Skip["Skip Update"]
    Diff -->|"Yes"| Section{"Section<br>Change?"}
    Section -->|"Yes"| Partial["Update Changed<br>Sections Only"]
    Section -->|"No"| Full["Full File<br>Update"]
    
    Partial --> tasks
    Full --> tasks
    
    style Update fill:#4da6ff,stroke:#0066cc,color:white
    style Diff fill:#ffa64d,stroke:#cc7a30,color:white
    style Section fill:#4dbb5f,stroke:#36873f,color:white
    style Partial fill:#d94dbb,stroke:#a3378a,color:white
    style Full fill:#4dbbbb,stroke:#368787,color:white
```

## ğŸ’» COMPLEXITY-BASED DOCUMENTATION

Documentation requirements scale based on complexity level:

| Documentation | Level 1 | Level 2 | Level 3 | Level 4 |
|---------------|---------|---------|---------|---------|
| Problem Definition | Brief | Standard | Detailed | Comprehensive |
| Options Analysis | Optional | Basic | Multiple Options | Extensive |
| Implementation Plan | Simple | Standard | Detailed | Phased |
| Testing Requirements | Basic | Standard | Comprehensive | Rigorous |
| Documentation | Minimal | Standard | Detailed | Extensive |

## ğŸ“‘ OPTIMIZED TEMPLATES BY LEVEL

### Level 1: Quick Fix Template
```markdown
## QUICK FIX: [Issue Name]
- Problem: [Brief description]
- Solution: [Implemented approach]
- Verification: [How fix was tested]
```

### Level 2: Enhancement Template
```markdown
## ENHANCEMENT: [Feature Name]
- Requirement: [What needs to be done]
- Approach: [How it was implemented]
- Testing: [Verification approach]
- Documentation: [Where documented]
```

### Level 3-4: Comprehensive Template
Uses the optimized creative phase template with appropriate documentation depth

## ğŸ”„ REFERENCE MAPS

Each mode's visual process map is optimized for token efficiency:

- @VAN Mode Map (Optimized)
- @PLAN Mode Map (Optimized)
- @CREATIVE Mode Map (Optimized)
- @IMPLEMENT Mode Map (Optimized)
- @REFLECT Mode Map (Optimized)
- @ARCHIVE Mode Map (Optimized)

## âš¡ TOKEN EFFICIENCY IMPROVEMENTS

Optimizations in this version:

1. Hierarchical rule loading (65% token reduction)
2. Progressive creative phase documentation (60% token reduction)
3. Context preservation during mode transitions (40% token reduction)
4. Differential Memory Bank updates (30% token reduction)
5. Complexity-based template scaling (varies by level)

## ğŸ’¡ USAGE GUIDANCE

To use the optimized system:

1. Start with the VAN command to initialize and determine complexity
2. Follow the complexity-appropriate workflow
3. Use progressive documentation appropriate to task complexity
4. Let the system manage rule loading and context preservation
5. Enjoy the improved token efficiency while maintaining structured development

---

## å·¥å…·å”ä½œçŸ©é™£ï¼ˆTool Collaboration Matrixï¼‰
- VANï¼šå…ˆç”¨ `sequential-thinking` æ˜ç¢ºè³‡è¨Šç¼ºå£ï¼›è‹¥éœ€å®˜æ–¹å…§å®¹â†’ `angular-cli.search_documentation`ï¼›ç¬¬ä¸‰æ–¹â†’ `Context7`ï¼ˆ`resolve-library-id` â†’ `get-library-docs`ï¼‰ã€‚
- PLANï¼šä»¥ `sequential-thinking` æ‹†è§£éœ€æ±‚èˆ‡ä¾è³´ï¼›æ¯å€‹æŠ€è¡“é»å„ªå…ˆå®˜æ–¹ï¼ˆAngular CLIï¼‰ï¼Œå¦å‰‡ `Context7`ï¼›åƒ…å–å¿…è¦æ®µè½ï¼ˆtokens å»ºè­° â‰¤ 3000ï¼‰ã€‚
- CREATIVEï¼šæ¯å€‹å€™é¸æ–¹æ¡ˆä»¥ `sequential-thinking` å»ºç«‹æ­¥é©Ÿï¼›ç”¨ `Context7`ï¼Angular CLI ä½è­‰ï¼›è¨˜éŒ„æ±ºç­–èˆ‡ `docSources`ã€‚
- IMPLEMENTï¼šé‡åˆ° API/å‹åˆ¥/ç›¸å®¹æ€§å•é¡Œå†æª¢ç´¢ï¼›å®Œæˆè®Šæ›´å¾ŒåŸ·è¡Œ Codacyï¼ˆWindows ç„¡ WSLï¼šæ¨™è¨˜äº¤ç”± CI/WSLï¼‰ã€‚
- QAï¼šæ¯”å°å®˜æ–¹è®Šæ›´æˆ– API å·®ç•°ï¼›å¿…è¦æ™‚ `Context7` äºŒæ¬¡æª¢ç´¢ï¼›å‡ºå…·å¯è¿½æº¯é€£çµã€‚
- REFLECT/ARCHIVEï¼šå½™æ•´æ±ºç­–èˆ‡ä¾†æºï¼›ä¿ç•™ `docSources` èˆ‡ `decisionTrace`ã€‚

å„ªå…ˆåºèˆ‡å›é€€
1) å®˜æ–¹å„ªå…ˆï¼ˆAngular â†’ Angular CLIï¼‰ï¼Œå†ç¬¬ä¸‰æ–¹ï¼ˆContext7ï¼‰
2) å…ˆæ±ºç­–ï¼ˆsequential-thinkingï¼‰å†æª¢ç´¢ï¼ˆé¿å…é‡å·¥ï¼‰
3) Windows ç„¡ WSLï¼šCodacy æ¨™è¨» `Codacy analysis pending (Windows no WSL)`ï¼Œç”± CI/WSL åŸ·è¡Œ

---

## ä¾†æºä¿ç•™ï¼ˆSource Retention / docSourcesï¼‰
æ–¼ Transition/Decision è¨˜éŒ„ä¸‹åˆ—æ¬„ä½ï¼Œä»¥åˆ©å¯è¿½æº¯/é‡ç¾/ç¨½æ ¸ï¼š
```markdown
- type: [Context7|AngularCLI]
- libraryId: [/org/project or N/A]
- topic: [e.g., routing]
- tokens: [requested tokens]
- urls: [list]
- decisionTraceId: [e.g., ST-YYYYMMDD-NN]
```
èªªæ˜
- å¯è¿½æº¯ï¼šèƒ½å›æº¯åˆ°åŸå§‹æ–‡ä»¶èˆ‡ç‰ˆæœ¬ä¸Šä¸‹æ–‡
- å¯é‡ç¾ï¼šæ—¥å¾Œå¯ç”¨ç›¸åŒåƒæ•¸é‡ç™¼è«‹æ±‚é©—è­‰
- ç¨½æ ¸å‹å–„ï¼šå¯©æŸ¥/å›æ­¸/åˆè¦æ™‚æœ‰æ“šå¯æŸ¥
